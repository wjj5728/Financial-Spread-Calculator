<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态利率理财利差计算器</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .calculator {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .input-field {
            flex: 1;
            min-width: 200px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            display: block;
            margin: 0 auto;
        }
        button:hover {
            background-color: #2980b9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            display: none;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 4px;
            display: none;
        }
        .error {
            color: #e74c3c;
            margin-top: 5px;
            display: none;
        }
        .yearly-rates {
            margin-top: 20px;
            display: none;
        }
        .rate-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        .rate-input {
            flex: 1;
            min-width: 120px;
        }
    </style>
</head>
<body>
    <h1>动态利率理财利差计算器</h1>
    
    <div class="calculator">
        <div class="input-group">
            <div class="input-field">
                <label for="principal">本金金额（元）</label>
                <input type="number" id="principal" min="1000" step="1000" value="100000">
                <div class="error" id="principal-error">请输入有效的本金金额</div>
            </div>
            
            <div class="input-field">
                <label for="investment-rate">理财年化收益率（%）</label>
                <input type="number" id="investment-rate" min="0.1" max="50" step="0.1" value="8">
                <div class="error" id="investment-error">请输入有效的理财利率</div>
            </div>
        </div>
        
        <div class="input-group">
            <div class="input-field">
                <label for="years">投资年限</label>
                <input type="number" id="years" min="1" max="30" value="5">
                <div class="error" id="years-error">请输入有效的年限</div>
            </div>
        </div>
        
        <div class="yearly-rates" id="yearly-rates">
            <h3>每年贷款利率（%）</h3>
            <div class="rate-inputs" id="rate-inputs">
                <!-- 动态生成的利率输入框将放在这里 -->
            </div>
        </div>
        
        <button id="calculate-btn">计算利差</button>
    </div>
    
    <table id="result-table">
        <thead>
            <tr>
                <th>年份</th>
                <th>理财本金</th>
                <th>理财收益</th>
                <th>贷款利息</th>
                <th>当年利差</th>
                <th>累计利差</th>
            </tr>
        </thead>
        <tbody id="result-body">
        </tbody>
    </table>
    
    <div class="summary" id="summary">
        <p><strong>最终理财本金：</strong> <span id="final-investment"></span> 元</p>
        <p><strong>累计利差总额：</strong> <span id="total-profit"></span> 元</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const yearsInput = document.getElementById('years');
            const yearlyRatesContainer = document.getElementById('yearly-rates');
            const rateInputsContainer = document.getElementById('rate-inputs');
            
            // 当年限变化时，生成对应数量的利率输入框
            yearsInput.addEventListener('change', function() {
                const years = parseInt(yearsInput.value);
                
                if (isNaN(years) || years <= 0) {
                    yearlyRatesContainer.style.display = 'none';
                    return;
                }
                
                rateInputsContainer.innerHTML = '';
                
                for (let i = 1; i <= years; i++) {
                    const rateInputDiv = document.createElement('div');
                    rateInputDiv.className = 'rate-input';
                    
                    const label = document.createElement('label');
                    label.textContent = `第 ${i} 年利率`;
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0.1';
                    input.max = '50';
                    input.step = '0.1';
                    input.value = '2.8';
                    input.className = 'loan-rate';
                    input.dataset.year = i;
                    
                    rateInputDiv.appendChild(label);
                    rateInputDiv.appendChild(input);
                    rateInputsContainer.appendChild(rateInputDiv);
                }
                
                yearlyRatesContainer.style.display = 'block';
            });
            
            // 初始加载时触发一次change事件
            yearsInput.dispatchEvent(new Event('change'));
            
            document.getElementById('calculate-btn').addEventListener('click', function() {
                // 获取输入值
                const principal = parseFloat(document.getElementById('principal').value);
                const investmentRate = parseFloat(document.getElementById('investment-rate').value) / 100;
                const years = parseInt(document.getElementById('years').value);
                
                // 获取每年的贷款利率
                const rateInputs = document.querySelectorAll('.loan-rate');
                const yearlyLoanRates = [];
                
                rateInputs.forEach(input => {
                    yearlyLoanRates.push(parseFloat(input.value) / 100);
                });
                
                // 验证输入
                let isValid = true;
                
                if (isNaN(principal) || principal <= 0) {
                    document.getElementById('principal-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('principal-error').style.display = 'none';
                }
                
                if (isNaN(investmentRate) || investmentRate <= 0) {
                    document.getElementById('investment-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('investment-error').style.display = 'none';
                }
                
                if (isNaN(years) || years <= 0) {
                    document.getElementById('years-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('years-error').style.display = 'none';
                }
                
                // 验证利率输入
                for (let i = 0; i < yearlyLoanRates.length; i++) {
                    if (isNaN(yearlyLoanRates[i]) || yearlyLoanRates[i] <= 0) {
                        alert(`请输入有效的第 ${i+1} 年贷款利率`);
                        isValid = false;
                        break;
                    }
                }
                
                if (!isValid) return;
                
                // 计算结果
                const results = calculateProfit(principal, investmentRate, yearlyLoanRates, years);
                
                // 显示结果表格
                displayResults(results);
            });
            
            function calculateProfit(principal, investmentRate, yearlyLoanRates, years) {
                const results = [];
                let investmentPrincipal = principal;
                let cumulativeProfit = 0;
                
                for (let year = 1; year <= years; year++) {
                    const investmentReturn = investmentPrincipal * investmentRate;
                    const loanInterest = principal * yearlyLoanRates[year-1];
                    const annualProfit = investmentReturn - loanInterest;
                    cumulativeProfit += annualProfit;
                    
                    results.push({
                        year,
                        investmentPrincipal: investmentPrincipal.toFixed(2),
                        investmentReturn: investmentReturn.toFixed(2),
                        loanInterest: loanInterest.toFixed(2),
                        annualProfit: annualProfit.toFixed(2),
                        cumulativeProfit: cumulativeProfit.toFixed(2)
                    });
                    
                    investmentPrincipal += parseFloat(investmentReturn);
                }
                
                return results;
            }
            
            function displayResults(results) {
                const tableBody = document.getElementById('result-body');
                tableBody.innerHTML = '';
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${result.year}</td>
                        <td>${result.investmentPrincipal}</td>
                        <td>${result.investmentReturn}</td>
                        <td>${result.loanInterest}</td>
                        <td>${result.annualProfit}</td>
                        <td>${result.cumulativeProfit}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // 显示表格和总结
                document.getElementById('result-table').style.display = 'table';
                document.getElementById('summary').style.display = 'block';
                
                // 更新总结信息
                const lastResult = results[results.length - 1];
                document.getElementById('final-investment').textContent = lastResult.investmentPrincipal;
                document.getElementById('total-profit').textContent = lastResult.cumulativeProfit;
            }
        });
    </script>
</body>
</html>
